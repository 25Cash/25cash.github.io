<?php 
  include './conn.php';

  if(isset($_POST['update'])){
    $img = $_FILES['profile'];
    $name = $_POST['name'];
    $uname = $_POST['username'];
    $pw = $_POST['password'];

    if($img['size'] == 0){
      $img = $sessImg;
      $qry = mysqli_query($con, "UPDATE admins SET names = '$name', username = '$uname', `password` = '$pw', profilepicture = '$img' WHERE id = '$sessId'");
      if($qry) {
        header('location: ./settings.php');
      }
    } else {
      $imgname = $img['name'];
      $tmp = $img['tmp_name'];
      $folder = '../img/profiles/users/'.$imgname;
      $move = move_uploaded_file($tmp, $folder);
      if($move){
        $qry = mysqli_query($con, "UPDATE admins SET names = '$name', username = '$uname', `password` = '$pw', profilepicture = '$imgname' WHERE id = '$sessId'");
        if($qry) {
          header('location: ./settings.php');
        }
      }
    }
  }

  if(isset($_GET['delete'])){
    $qry = mysqli_query($con, "DELETE FROM admins WHERE id = '$sessId'");
    if($qry){
      session_destroy();
      header('location: ../');
    }
  }
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meet-Me Date App</title>
  <link rel="stylesheet" href="../scss/style.css">
  <link rel="shortcut icon" href="../img/main/logo.svg" type="image/x-icon">
</head>
<body>
  <main>
    <aside class="toggled">
      <div class="top">
        <div class="logo">
          <img src="../img/main/logo.svg" alt="Logo" />
          <span>Meet Me Dating App</span>
        </div>
        <nav>
          <a href="./">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48"><path d="M24 3C22.458334 3 21.112148 3.6321334 20.253906 4.5976562C19.395664 5.5631791 19 6.7916668 19 8C19 9.2083332 19.395664 10.436821 20.253906 11.402344C21.112148 12.367867 22.458334 13 24 13C25.541666 13 26.887852 12.367867 27.746094 11.402344C28.604336 10.436821 29 9.2083332 29 8C29 6.7916668 28.604336 5.5631791 27.746094 4.5976562C26.887852 3.6321334 25.541666 3 24 3 z M 24 6C24.791666 6 25.195482 6.2428666 25.503906 6.5898438C25.81233 6.9368209 26 7.4583332 26 8C26 8.5416668 25.81233 9.0631791 25.503906 9.4101562C25.195482 9.7571335 24.791666 10 24 10C23.208334 10 22.804518 9.7571335 22.496094 9.4101562C22.18767 9.0631791 22 8.5416668 22 8C22 7.4583332 22.18767 6.9368209 22.496094 6.5898438C22.804518 6.2428666 23.208334 6 24 6 z M 13 9C11.125 9 9.5288151 9.7571337 8.5039062 10.910156C7.4789976 12.063179 7 13.541667 7 15C7 16.458333 7.4789975 17.936821 8.5039062 19.089844C9.5288151 20.242867 11.125 21 13 21C14.875 21 16.471185 20.242867 17.496094 19.089844C18.521003 17.936821 19 16.458333 19 15C19 13.541667 18.521003 12.063179 17.496094 10.910156C16.471185 9.7571337 14.875 9 13 9 z M 35 9C33.125 9 31.528815 9.7571337 30.503906 10.910156C29.478997 12.063179 29 13.541667 29 15C29 16.458333 29.478997 17.936821 30.503906 19.089844C31.528815 20.242867 33.125 21 35 21C36.875 21 38.471185 20.242867 39.496094 19.089844C40.521003 17.936821 41 16.458333 41 15C41 13.541667 40.521003 12.063179 39.496094 10.910156C38.471185 9.7571337 36.875 9 35 9 z M 13 12C14.124999 12 14.778816 12.367867 15.253906 12.902344C15.728997 13.436821 16 14.208333 16 15C16 15.791667 15.728997 16.563179 15.253906 17.097656C14.778816 17.632133 14.124999 18 13 18C11.875001 18 11.221184 17.632133 10.746094 17.097656C10.271003 16.563179 10 15.791667 10 15C10 14.208333 10.271003 13.436821 10.746094 12.902344C11.221184 12.367867 11.875001 12 13 12 z M 35 12C36.124999 12 36.778816 12.367867 37.253906 12.902344C37.728997 13.436821 38 14.208333 38 15C38 15.791667 37.728997 16.563179 37.253906 17.097656C36.778816 17.632133 36.124999 18 35 18C33.875001 18 33.221184 17.632133 32.746094 17.097656C32.271003 16.563179 32 15.791667 32 15C32 14.208333 32.271003 13.436821 32.746094 12.902344C33.221184 12.367867 33.875001 12 35 12 z M 24 19C22.125 19 20.528815 19.757133 19.503906 20.910156C18.478997 22.063179 18 23.541667 18 25C18 26.458333 18.478997 27.936821 19.503906 29.089844C20.528815 30.242867 22.125 31 24 31C25.875 31 27.471185 30.242867 28.496094 29.089844C29.521003 27.936821 30 26.458333 30 25C30 23.541667 29.521003 22.063179 28.496094 20.910156C27.471185 19.757133 25.875 19 24 19 z M 24 22C25.124999 22 25.778816 22.367867 26.253906 22.902344C26.728997 23.436821 27 24.208333 27 25C27 25.791667 26.728997 26.563179 26.253906 27.097656C25.778816 27.632133 25.124999 28 24 28C22.875001 28 22.221184 27.632133 21.746094 27.097656C21.271003 26.563179 21 25.791667 21 25C21 24.208333 21.271003 23.436821 21.746094 22.902344C22.221184 22.367867 22.875001 22 24 22 z M 7.5 23C5.57 23 4 24.57 4 26.5L4 29C4 32.36 7.95 35 13 35L13.210938 35C13.660937 33.39 14.839375 32.079688 16.359375 31.429688C15.409375 31.779688 14.26 32 13 32C9.57 32 7 30.42 7 29L7 26.5C7 26.22 7.22 26 7.5 26L16.060547 26C16.020547 25.67 16 25.34 16 25C16 24.31 16.09 23.64 16.25 23L7.5 23 z M 31.75 23C31.91 23.64 32 24.31 32 25C32 25.34 31.979453 25.67 31.939453 26L40.5 26C40.78 26 41 26.22 41 26.5L41 29C41 30.42 38.43 32 35 32C33.74 32 32.590625 31.779688 31.640625 31.429688C33.160625 32.079687 34.339063 33.39 34.789062 35L35 35C40.05 35 44 32.36 44 29L44 26.5C44 24.57 42.43 23 40.5 23L31.75 23 z M 18.5 33C16.585045 33 15 34.585045 15 36.5L15 39C15 40.918154 16.279921 42.481204 17.925781 43.46875C19.571641 44.456296 21.68576 45 24 45C26.31424 45 28.428359 44.456296 30.074219 43.46875C31.720079 42.481204 33 40.918154 33 39L33 36.5C33 34.585045 31.414955 33 29.5 33L18.5 33 z M 18.5 36L29.5 36C29.795045 36 30 36.204955 30 36.5L30 39C30 39.566846 29.59989 40.255281 28.53125 40.896484C27.46261 41.537688 25.82776 42 24 42C22.17224 42 20.53739 41.537688 19.46875 40.896484C18.40011 40.255281 18 39.566846 18 39L18 36.5C18 36.204955 18.204955 36 18.5 36 z"/></svg>
            <span>All Users</span>
          </a>
          <a href="./settings.php" class="router-link-active">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48"><path d="M39.139,26.282C38.426,25.759,38,24.919,38,24.034s0.426-1.725,1.138-2.247l3.294-2.415c0.525-0.386,0.742-1.065,0.537-1.684c-0.848-2.548-2.189-4.872-3.987-6.909c-0.433-0.488-1.131-0.642-1.728-0.38l-3.709,1.631c-0.808,0.356-1.749,0.305-2.516-0.138c-0.766-0.442-1.28-1.23-1.377-2.109l-0.446-4.072c-0.071-0.648-0.553-1.176-1.191-1.307c-2.597-0.531-5.326-0.54-7.969-0.01c-0.642,0.129-1.125,0.657-1.196,1.308l-0.442,4.046c-0.097,0.88-0.611,1.668-1.379,2.11c-0.766,0.442-1.704,0.495-2.515,0.138l-3.729-1.64c-0.592-0.262-1.292-0.11-1.725,0.377c-1.804,2.029-3.151,4.35-4.008,6.896c-0.208,0.618,0.008,1.301,0.535,1.688l3.273,2.4C9.574,22.241,10,23.081,10,23.966s-0.426,1.725-1.138,2.247l-3.294,2.415c-0.525,0.386-0.742,1.065-0.537,1.684c0.848,2.548,2.189,4.872,3.987,6.909c0.433,0.489,1.133,0.644,1.728,0.38l3.709-1.631c0.808-0.356,1.748-0.305,2.516,0.138c0.766,0.442,1.28,1.23,1.377,2.109l0.446,4.072c0.071,0.648,0.553,1.176,1.191,1.307C21.299,43.864,22.649,44,24,44c1.318,0,2.648-0.133,3.953-0.395c0.642-0.129,1.125-0.657,1.196-1.308l0.443-4.046c0.097-0.88,0.611-1.668,1.379-2.11c0.766-0.441,1.705-0.493,2.515-0.138l3.729,1.64c0.594,0.263,1.292,0.111,1.725-0.377c1.804-2.029,3.151-4.35,4.008-6.896c0.208-0.618-0.008-1.301-0.535-1.688L39.139,26.282z M24,31c-3.866,0-7-3.134-7-7s3.134-7,7-7s7,3.134,7,7S27.866,31,24,31z"/></svg>
            <span>Settings</span>
          </a>
        </nav>
      </div>
      <a href="" class='logOut'>
        <svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48"><path d="M23.970703 3.9726562 A 2.0002 2.0002 0 0 0 22 6L22 22 A 2.0002 2.0002 0 1 0 26 22L26 6 A 2.0002 2.0002 0 0 0 23.970703 3.9726562 z M 17.03125 9.5957031 A 2.0002 2.0002 0 0 0 16.125 9.8105469C10.126881 12.732506 6 18.900262 6 26C6 35.917759 14.082241 44 24 44C33.917759 44 42 35.917759 42 26C42 18.900051 37.873521 12.733423 31.876953 9.8105469 A 2.0003292 2.0003292 0 1 0 30.123047 13.40625C34.782479 15.677373 38 20.447949 38 26C38 33.756241 31.756241 40 24 40C16.243759 40 10 33.756241 10 26C10 20.447738 13.215119 15.676291 17.875 13.40625 A 2.0002 2.0002 0 0 0 17.03125 9.5957031 z"/></svg>
        <span>Log Out</span>
      </a>
    </aside>
    <div class="router">
      <div class="router-page">
        <?php include 'top_nav.php'?>
        <div class="innerPage hasIn">
          <div class="form-page hasForm">
            <h1>Update Your Profile</h1>
            <div class="form">
              <!-- <div class="logo">
                <img src="./img/main/logo.svg" alt="Meet Me Logo" draggable="false">
                <p>Meet Me Dating App</p>
              </div> -->
              <form action="" method="POST" enctype="multipart/form-data">
                <div class="parts-img">
                  <div class="crd-image">
                    <label id="profilepreview" for="profile">
                      <img src="../img/profiles/users/<?php echo $sessImg?>" alt="" id="imagePrev">
                      <!-- <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48"><path d="M11.5 6C8.4802259 6 6 8.4802259 6 11.5L6 36.5C6 39.519774 8.4802259 42 11.5 42L36.5 42C39.519774 42 42 39.519774 42 36.5L42 11.5C42 8.4802259 39.519774 6 36.5 6L11.5 6 z M 11.5 9L36.5 9C37.898226 9 39 10.101774 39 11.5L39 31.955078L32.988281 26.138672 A 1.50015 1.50015 0 0 0 32.986328 26.136719C32.208234 25.385403 31.18685 25 30.173828 25C29.16122 25 28.13988 25.385387 27.361328 26.138672L25.3125 28.121094L19.132812 22.142578C18.35636 21.389748 17.336076 21 16.318359 21C15.299078 21 14.280986 21.392173 13.505859 22.140625 A 1.50015 1.50015 0 0 0 13.503906 22.142578L9 26.5L9 11.5C9 10.101774 10.101774 9 11.5 9 z M 30.5 13C29.125 13 27.903815 13.569633 27.128906 14.441406C26.353997 15.313179 26 16.416667 26 17.5C26 18.583333 26.353997 19.686821 27.128906 20.558594C27.903815 21.430367 29.125 22 30.5 22C31.875 22 33.096185 21.430367 33.871094 20.558594C34.646003 19.686821 35 18.583333 35 17.5C35 16.416667 34.646003 15.313179 33.871094 14.441406C33.096185 13.569633 31.875 13 30.5 13 z M 30.5 16C31.124999 16 31.403816 16.180367 31.628906 16.433594C31.853997 16.686821 32 17.083333 32 17.5C32 17.916667 31.853997 18.313179 31.628906 18.566406C31.403816 18.819633 31.124999 19 30.5 19C29.875001 19 29.596184 18.819633 29.371094 18.566406C29.146003 18.313179 29 17.916667 29 17.5C29 17.083333 29.146003 16.686821 29.371094 16.433594C29.596184 16.180367 29.875001 16 30.5 16 z M 16.318359 24C16.578643 24 16.835328 24.09366 17.044922 24.296875 A 1.50015 1.50015 0 0 0 17.046875 24.298828L23.154297 30.207031L14.064453 39L11.5 39C10.101774 39 9 37.898226 9 36.5L9 30.673828L15.589844 24.298828C15.802764 24.093234 16.059641 24 16.318359 24 z M 30.173828 28C30.438806 28 30.692485 28.09229 30.902344 28.294922L39 36.128906L39 36.5C39 37.898226 37.898226 39 36.5 39L18.380859 39L29.447266 28.294922C29.654714 28.094207 29.910436 28 30.173828 28 z"/></svg> -->
                    </label>
                    <input type="file" name="profile" id="profile" accept="image/*">
                  </div>
                </div>
                <br>
                <div class="parts">
                  <div class="crd">
                    <label>Name</label>
                    <div class="crd-input">
                      <input 
                        type="text" 
                        placeholder="Name" 
                        required
                        name="name"
                        value="<?php echo $sessname?>"
                      />
                      <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48"><path d="M24 4C18.494917 4 14 8.494921 14 14C14 19.505079 18.494917 24 24 24C29.505083 24 34 19.505079 34 14C34 8.494921 29.505083 4 24 4 z M 24 7C27.883764 7 31 10.116238 31 14C31 17.883762 27.883764 21 24 21C20.116236 21 17 17.883762 17 14C17 10.116238 20.116236 7 24 7 z M 12.5 28C10.032499 28 8 30.032499 8 32.5L8 33.699219C8 36.640082 9.8647133 39.277974 12.708984 41.091797C15.553256 42.90562 19.444841 44 24 44C28.555159 44 32.446744 42.90562 35.291016 41.091797C38.135287 39.277974 40 36.640082 40 33.699219L40 32.5C40 30.032499 37.967501 28 35.5 28L12.5 28 z M 12.5 31L35.5 31C36.346499 31 37 31.653501 37 32.5L37 33.699219C37 35.364355 35.927463 37.127823 33.677734 38.5625C31.428006 39.997177 28.068841 41 24 41C19.931159 41 16.571994 39.997177 14.322266 38.5625C12.072537 37.127823 11 35.364355 11 33.699219L11 32.5C11 31.653501 11.653501 31 12.5 31 z"/></svg>
                      </div>
                    </div>
                  </div>
                  <div class="crd">
                    <label>Username</label>
                    <div class="crd-input">
                      <input 
                        type="text" 
                        placeholder="Username" 
                        required
                        name="username"
                        value="<?php echo $sessuname?>"
                      />
                      <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48"><path d="M24 4C18.494917 4 14 8.494921 14 14C14 19.505079 18.494917 24 24 24C29.505083 24 34 19.505079 34 14C34 8.494921 29.505083 4 24 4 z M 24 7C27.883764 7 31 10.116238 31 14C31 17.883762 27.883764 21 24 21C20.116236 21 17 17.883762 17 14C17 10.116238 20.116236 7 24 7 z M 12.5 28C10.032499 28 8 30.032499 8 32.5L8 33.699219C8 36.640082 9.8647133 39.277974 12.708984 41.091797C15.553256 42.90562 19.444841 44 24 44C28.555159 44 32.446744 42.90562 35.291016 41.091797C38.135287 39.277974 40 36.640082 40 33.699219L40 32.5C40 30.032499 37.967501 28 35.5 28L12.5 28 z M 12.5 31L35.5 31C36.346499 31 37 31.653501 37 32.5L37 33.699219C37 35.364355 35.927463 37.127823 33.677734 38.5625C31.428006 39.997177 28.068841 41 24 41C19.931159 41 16.571994 39.997177 14.322266 38.5625C12.072537 37.127823 11 35.364355 11 33.699219L11 32.5C11 31.653501 11.653501 31 12.5 31 z"/></svg>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="parts">
                  <div class="crd">
                    <label>Password</label>
                    <div class="crd-input">
                      <input
                        type="password"
                        placeholder="Password"
                        required
                        name="password"
                        value="<?php echo $sesspw?>"
                      />
                      <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48"><path d="M24 4C19.599415 4 16 7.599415 16 12L16 16L12.5 16C10.032499 16 8 18.032499 8 20.5L8 39.5C8 41.967501 10.032499 44 12.5 44L35.5 44C37.967501 44 40 41.967501 40 39.5L40 20.5C40 18.032499 37.967501 16 35.5 16L32 16L32 12C32 7.599415 28.400585 4 24 4 z M 24 7C26.779415 7 29 9.220585 29 12L29 16L19 16L19 12C19 9.220585 21.220585 7 24 7 z M 12.5 19L35.5 19C36.346499 19 37 19.653501 37 20.5L37 39.5C37 40.346499 36.346499 41 35.5 41L12.5 41C11.653501 41 11 40.346499 11 39.5L11 20.5C11 19.653501 11.653501 19 12.5 19 z M 17 28 A 2 2 0 0 0 17 32 A 2 2 0 0 0 17 28 z M 24 28 A 2 2 0 0 0 24 32 A 2 2 0 0 0 24 28 z M 31 28 A 2 2 0 0 0 31 32 A 2 2 0 0 0 31 28 z"/></svg>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-buttons">
                  <button type="submit" name="update">Update Your Profile</button>
                  <a href="./settings.php?delete">Delete Account</a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script>
    let inpt = document.querySelector('#profile');
    let img = document.querySelector('#imagePrev');
    inpt.addEventListener('input', ev => {
      let url = URL.createObjectURL(ev.target.files[0]);
      let label = document.querySelector('#profilepreview');
      label.classList.remove('first-prev');
      img.src = url;
    })
  </script>
</body>
</html>